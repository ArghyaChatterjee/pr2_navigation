<launch>

<node pkg="topic_tools" type="throttle" name="base_scan_throttle" args="messages base_scan 1.0 base_scan_throttled" output="screen"/>
<node pkg="topic_tools" type="throttle" name="tilt_scan_throttle" args="messages tilt_scan 1.0 tilt_scan_throttled" />
<node pkg="topic_tools" type="throttle" name="tilt_scan_filtered_throttle" args="messages tilt_scan_filtered 1.0 tilt_scan_filtered_throttled" />
<node pkg="topic_tools" type="throttle" name="base_scan_marking_throttle" args="messages base_scan_marking 1.0 base_scan_marking_throttled" />


<!-- Marking: Filter for tilt laser shadowing/veiling -->
<!-- IN: x_scan  OUT: x_scan_shodow_filtered -->
<node pkg="laser_filters" type="scan_to_cloud_filter_chain" respawn="true" machine="c2" name="tilt_shadow_filter">
  <remap from="scan" to="tilt_scan" />
  <remap from="cloud_filtered" to="tilt_scan_shadow_filtered" />
  <param name="target_frame" value="base_footprint" />
  <param name="high_fidelity" value="true" />
  <rosparam command="load" file="$(find pr2_navigation_perception)/config/tilt_laser_filters.yaml" />
</node>
<node pkg="laser_filters" type="scan_to_cloud_filter_chain" respawn="true" machine="c2" name="base_shadow_filter" >
  <remap from="scan" to="base_scan" />
  <remap from="cloud_filtered" to="base_scan_shadow_filtered" />
  <param name="target_frame" value="base_footprint" />
  <rosparam command="load" file="$(find pr2_navigation_perception)/config/shadow_filter.yaml" />
</node>


<!-- Marking: Filter for tilt laser scans that hit the body of the robot -->
<!-- IN: x_scan_shadow_filtered  OUT: x_scan_filtered -->
<node pkg="pr2_navigation_self_filter" type="self_filter" name="tilt_laser_self_filter_nav" respawn="true" output="screen">
  <!-- The topic for the input cloud -->
  <remap from="cloud_in" to="tilt_scan_shadow_filtered" />
  <!-- The topic for the output cloud -->
  <remap from="cloud_out" to="tilt_scan_filtered" />
  <rosparam command="load" file="$(find pr2_navigation_perception)/config/tilt_self_filter.yaml" />
  <!-- The frame of the sensor used to obtain the data to be
    filtered; This parameter is optional. If it is not specified,
    shadow points will be considered outside -->
  <param name="sensor_frame" type="string" value="laser_tilt_link" />
</node>
<node pkg="pr2_navigation_self_filter" type="self_filter" name="base_laser_self_filter_nav" respawn="true" output="screen">
  <!-- The topic for the input cloud -->
  <remap from="cloud_in" to="base_scan_shadow_filtered" />
  <!-- The topic for the output cloud -->
  <remap from="cloud_out" to="base_scan_filtered" />
  <!-- The frame of the sensor used to obtain the data to be
    filtered; This parameter is optional. If it is not specified,
    shadow points will be considered outside -->
  <param name="sensor_frame" type="string" value="base_laser_link" />
  <rosparam command="load" file="$(find pr2_navigation_perception)/config/base_self_filter.yaml" />
</node>


<!-- IN: x_scan_filtered  OUT: x_scan_footprint_large -->
<node pkg="cloud_filter" type="cloud_to_cloud_filter_chain" respawn="true" machine="c2" name="tilt_footprint_large_filter">
  <remap from="cloud" to="tilt_scan_filtered" />
  <remap from="cloud_filtered" to="tilt_scan_footprint_large" />
  <param name="target_frame" value="base_footprint" />
  <param name="high_fidelity" value="true" />
  <rosparam command="load" file="$(find pr2_navigation_perception)/config/point_cloud_footprint_large_filter.yaml" />
</node>
<node pkg="cloud_filter" type="cloud_to_cloud_filter_chain" respawn="true" machine="c2" name="base_large_footprint_large_filter" >
  <remap from="cloud" to="base_scan_filtered" />
  <remap from="cloud_filtered" to="base_scan_footprint_large" />
  <param name="target_frame" value="base_footprint" />
  <rosparam command="load" file="$(find pr2_navigation_perception)/config/point_cloud_footprint_large_filter.yaml" />
</node>

<!-- IN: x_scan_filtered  OUT: x_scan_footprint_small -->
<node pkg="cloud_filter" type="cloud_to_cloud_filter_chain" respawn="true" machine="c2" name="tilt_footprint_small_filter">
  <remap from="cloud" to="tilt_scan_filtered" />
  <remap from="cloud_filtered" to="tilt_scan_footprint_small" />
  <param name="target_frame" value="base_footprint" />
  <param name="high_fidelity" value="true" />
  <rosparam command="load" file="$(find pr2_navigation_perception)/config/point_cloud_footprint_small_filter.yaml" />
</node>
<node pkg="cloud_filter" type="cloud_to_cloud_filter_chain" respawn="true" machine="c2" name="base_footprint_small_filter" >
  <remap from="cloud" to="base_scan_filtered" />
  <remap from="cloud_filtered" to="base_scan_footprint_small" />
  <param name="target_frame" value="base_footprint" />
  <rosparam command="load" file="$(find pr2_navigation_perception)/config/point_cloud_footprint_small_filter.yaml" />
</node>



<!-- Clearning: scan to scan laser filters -->
<node pkg="laser_filters" type="scan_to_scan_filter_chain" respawn="true" machine="c2" name="base_max_range_filter">
  <remap from="scan" to="base_scan" />
  <remap from="scan_filtered" to="base_scan_clearing" />
  <rosparam command="load" file="$(find pr2_navigation_perception)/config/max_range_filter.yaml" />
</node>
<node pkg="laser_filters" type="scan_to_scan_filter_chain" respawn="true" machine="c2" name="tilt_max_range_filter">
  <remap from="scan" to="tilt_scan" />
  <remap from="scan_filtered" to="tilt_scan_clearing" />
  <rosparam command="load" file="$(find pr2_navigation_perception)/config/max_range_filter.yaml" />
</node>


</launch>
